## 1. KMP ç®—æ³•ä»‹ç»

KMP ç®—æ³•çš„å…¨å«åš **ã€ŒKnuth Morris Pratt ç®—æ³•ã€**ï¼Œæ˜¯ç”±å®ƒçš„ä¸‰ä½å‘æ˜è€… Donald Knuthã€James H. Morrisã€ Vaughan Pratt çš„åå­—æ¥å‘½åçš„ã€‚KMP ç®—æ³•æ˜¯ä»–ä»¬ä¸‰äººåœ¨ 1977 å¹´è”åˆå‘è¡¨çš„ã€‚

> **KMP ç®—æ³•æ€æƒ³**ï¼šå¯¹äºç»™å®šæ–‡æœ¬ä¸² `T` ä¸æ¨¡å¼ä¸² `p`ï¼Œå½“å‘ç°æ–‡æœ¬ä¸² `T` çš„æŸä¸ªå­—ç¬¦ä¸æ¨¡å¼ä¸² `p` ä¸åŒ¹é…çš„æ—¶å€™ï¼Œå¯ä»¥åˆ©ç”¨åŒ¹é…å¤±è´¥åçš„ä¿¡æ¯ï¼Œå°½é‡å‡å°‘æ¨¡å¼ä¸²ä¸æ–‡æœ¬ä¸²çš„åŒ¹é…æ¬¡æ•°ï¼Œé¿å…æ–‡æœ¬ä¸²ä½ç½®çš„å›é€€ï¼Œä»¥è¾¾åˆ°å¿«é€ŸåŒ¹é…çš„ç›®çš„ã€‚

### 1.1 æœ´ç´ åŒ¹é…ç®—æ³•çš„ç¼ºé™·

åœ¨æœ´ç´ åŒ¹é…ç®—æ³•çš„åŒ¹é…è¿‡ç¨‹ä¸­ï¼Œæˆ‘ä»¬åˆ†åˆ«ç”¨æŒ‡é’ˆ `i` å’ŒæŒ‡é’ˆ `j` æŒ‡ç¤ºæ–‡æœ¬ä¸² `T` å’Œæ¨¡å¼ä¸² `p` ä¸­å½“å‰æ­£åœ¨å¯¹æ¯”çš„å­—ç¬¦ã€‚å½“å‘ç°æ–‡æœ¬ä¸² `T` çš„æŸä¸ªå­—ç¬¦ä¸æ¨¡å¼ä¸² `p` ä¸åŒ¹é…çš„æ—¶å€™ï¼Œ`j` å›é€€åˆ°å¼€å§‹ä½ç½®ï¼Œ`i` å›é€€åˆ°ä¹‹å‰åŒ¹é…å¼€å§‹ä½ç½®çš„ä¸‹ä¸€ä¸ªä½ç½®ä¸Šï¼Œç„¶åå¼€å¯æ–°ä¸€è½®çš„åŒ¹é…ï¼Œå¦‚å›¾æ‰€ç¤ºã€‚

![](https://qcdn.itcharge.cn/images/20220205003716.png)

è¿™æ ·ï¼Œåœ¨ Brute Force ç®—æ³•ä¸­ï¼Œå¦‚æœä»æ–‡æœ¬ä¸² `T[i]` å¼€å§‹çš„è¿™ä¸€è¶Ÿå­—ç¬¦ä¸²æ¯”è¾ƒå¤±è´¥äº†ï¼Œç®—æ³•ä¼šç›´æ¥å¼€å§‹å°è¯•ä» `T[i + 1]` å¼€å§‹æ¯”è¾ƒã€‚å¦‚æœ `i` å·²ç»æ¯”è¾ƒåˆ°äº†åè¾¹ä½ç½®ï¼Œåˆ™è¯¥æ“ä½œç›¸å½“äºå°†æŒ‡é’ˆ `i` è¿›è¡Œäº†å›é€€æ“ä½œã€‚

é‚£ä¹ˆæœ‰æ²¡æœ‰å“ªç§ç®—æ³•ï¼Œå¯ä»¥è®© `i` ä¸å‘ç”Ÿå›é€€ï¼Œå¯ä»¥ä¸€ç›´å‘å‰ç§»åŠ¨ `i` å‘¢ï¼Ÿ

### 1.2 KMP ç®—æ³•çš„æ”¹è¿›

å¦‚æœæˆ‘ä»¬å¯ä»¥é€šè¿‡æ¯ä¸€æ¬¡çš„å¤±é…è€Œå¾—åˆ°ä¸€äº›ã€Œä¿¡æ¯ã€ï¼Œå¹¶ä¸”è¿™äº›ã€Œä¿¡æ¯ã€å¯ä»¥å¸®åŠ©æˆ‘ä»¬è·³è¿‡é‚£äº›ä¸å¯èƒ½åŒ¹é…æˆåŠŸçš„ä½ç½®ï¼Œé‚£ä¹ˆæˆ‘ä»¬å°±èƒ½å¤§å¤§å‡å°‘æ¨¡å¼ä¸²ä¸æ–‡æœ¬ä¸²çš„åŒ¹é…æ¬¡æ•°ï¼Œä»è€Œè¾¾åˆ°å¿«é€ŸåŒ¹é…çš„ç›®çš„ã€‚

æ¯ä¸€æ¬¡å¤±é…æ‰€å‘Šè¯‰æˆ‘ä»¬çš„ä¿¡æ¯æ˜¯ï¼š**ä¸»ä¸²çš„æŸä¸€ä¸ªå­ä¸²ç­‰äºæ¨¡å¼ä¸²çš„æŸä¸€ä¸ªå‰ç¼€**ã€‚

è¿™ä¸ªä¿¡æ¯çš„æ„æ€æ˜¯ï¼šå¦‚æœæ–‡æœ¬ä¸² `T[i: i + m]` ä¸æ¨¡å¼ä¸² `p` çš„å¤±é…æ˜¯ä¸‹æ ‡ä½ç½® `j` ä¸Šå‘ç”Ÿçš„ï¼Œé‚£ä¹ˆæ–‡æœ¬ä¸² `T` ä»ä¸‹æ ‡ä½ç½® `i` å¼€å§‹è¿ç»­çš„ `j - 1` ä¸ªå­—ç¬¦ï¼Œä¸€å®šä¸æ¨¡å¼ä¸² `p` çš„å‰ `j - 1` ä¸ªå­—ç¬¦ä¸€æ¨¡ä¸€æ ·ï¼Œå³ï¼š`T[i: i + j] == p[0: j]`ã€‚

ä½†æ˜¯çŸ¥é“è¿™ä¸ªä¿¡æ¯æœ‰ä»€ä¹ˆç”¨å‘¢ï¼Ÿ

ä»¥åˆšæ‰å›¾ä¸­çš„ä¾‹å­æ¥è¯´ï¼Œæ–‡æœ¬ä¸²çš„å­ä¸² `T[i: i + m]` ä¸æ¨¡å¼ä¸² `p` çš„å¤±é…æ˜¯åœ¨ç¬¬ `5` ä¸ªä½ç½®å‘ç”Ÿçš„ï¼Œé‚£ä¹ˆï¼š

- æ–‡æœ¬ä¸² `T` ä»ä¸‹æ ‡ä½ç½® `i` å¼€å§‹è¿ç»­çš„ `5` ä¸ªå­—ç¬¦ï¼Œä¸€å®šä¸æ¨¡å¼ä¸² `p` çš„å‰ `5` ä¸ªå­—ç¬¦ä¸€æ¨¡ä¸€æ ·ï¼Œå³ï¼š`"ABCAB" == "ABCAB"`ã€‚
- è€Œæ¨¡å¼ä¸²çš„å‰ `5` ä¸ªå­—ç¬¦ä¸­ï¼Œå‰ `2` ä½å‰ç¼€å’Œå `2` ä½åç¼€åˆæ˜¯ç›¸åŒçš„ï¼Œå³ `"AB" == "AB"`ã€‚

æ‰€ä»¥æˆ‘ä»¬å¯ä»¥æ¨çŸ¥ï¼šæ–‡æœ¬ä¸²å­ä¸²çš„å `2` ä½åç¼€å’Œæ¨¡å¼ä¸²å­ä¸²çš„å‰ `2` ä½æ˜¯ç›¸åŒçš„ï¼Œå³ `T[i + 3: i + 5] == p[0: 2]`ï¼Œè¿™éƒ¨åˆ†ï¼ˆå³ä¸‹å›¾ä¸­è“è‰²éƒ¨åˆ†ï¼‰æ˜¯å·²ç»æ¯”è¾ƒè¿‡çš„ï¼Œä¸éœ€è¦å†æ¯”è¾ƒäº†ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†æ–‡æœ¬ä¸²ä¸­çš„ `T[i + 5]` å¯¹å‡†æ¨¡å¼ä¸²ä¸­çš„ `p[2]`ï¼Œç»§ç»­è¿›è¡Œå¯¹æ¯”ã€‚

![](https://qcdn.itcharge.cn/images/20220205003701.png)

KMP ç®—æ³•å°±æ˜¯ä½¿ç”¨äº†è¿™æ ·çš„æ€è·¯ï¼Œå¯¹æ¨¡å¼ä¸² `p` è¿›è¡Œäº†é¢„å¤„ç†ï¼Œåˆ©ç”¨å­—ç¬¦ä¸²åŒ¹é…å¤±è´¥åçš„ä¿¡æ¯ï¼Œè®¡ç®—å‡ºä¸€ä¸ª **ã€Œéƒ¨åˆ†åŒ¹é…è¡¨ã€**ï¼Œç”¨ä¸€ä¸ªæ•°ç»„ `next` æ¥è®°å½•ã€‚ç„¶ååœ¨æ¯æ¬¡å¤±é…å‘ç”Ÿæ—¶ï¼Œä¸å›é€€æ–‡æœ¬æŒ‡é’ˆ `i`ï¼Œè€Œæ˜¯æ ¹æ®ã€Œéƒ¨åˆ†åŒ¹é…è¡¨ã€ä¸­æ¨¡å¼ä¸²å¤±é…ä½ç½® `j` çš„å‰ä¸€ä¸ªä½ç½®çš„å€¼ï¼Œå³ `next[j - 1]` çš„å€¼æ¥å†³å®šæ¨¡å¼ä¸²å¯ä»¥å‘å³ç§»åŠ¨çš„ä½æ•°ã€‚

æ¯”å¦‚ä¸Šè¿°ç¤ºä¾‹ä¸­æ¨¡å¼ä¸² `p` æ˜¯åœ¨ `j = 5` çš„ä½ç½®ä¸Šå‘ç”Ÿå¤±é…çš„ï¼Œåˆ™è¯´æ˜æ–‡æœ¬ä¸²çš„å­ä¸² `T[i: i + 5]` å’Œæ¨¡å¼ä¸² `p[0: 5]` çš„å­—ç¬¦æ˜¯ä¸€è‡´çš„ï¼Œå³ `"ABCAB" == "ABCAB"`ã€‚è€Œæ ¹æ®ã€Œéƒ¨åˆ†åŒ¹é…è¡¨ã€ä¸­ `next[4] == 2`ï¼Œæ‰€ä»¥ä¸ç”¨å›é€€ `i`ï¼Œè€Œæ˜¯å°† `j` ç§»åŠ¨åˆ°ä¸‹æ ‡ä¸º `2` çš„ä½ç½®ï¼Œè®© `T[i + 5]` ç›´æ¥å¯¹å‡† `p[2]`ï¼Œç„¶åç»§ç»­è¿›è¡Œæ¯”å¯¹ã€‚

### 1.3 next æ•°ç»„

ä¸Šæ–‡æåˆ°çš„ã€Œéƒ¨åˆ†åŒ¹é…è¡¨ã€ï¼Œä¹Ÿå«åšã€Œå‰ç¼€è¡¨ã€ï¼Œåœ¨ KMP ç®—æ³•ä¸­ä½¿ç”¨ `next` æ•°ç»„å­˜å‚¨ã€‚`next[j]` è¡¨ç¤ºçš„å«ä¹‰æ˜¯ï¼š**è®°å½•ä¸‹æ ‡ j ä¹‹å‰ï¼ˆåŒ…æ‹¬ jï¼‰çš„æ¨¡å¼ä¸² `p` ä¸­ï¼Œæœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦ã€‚**

ç®€å•è€Œè¨€ï¼Œå°±æ˜¯æ±‚ï¼š**æ¨¡å¼ä¸² `p` çš„å­ä¸² `p[0: j + 1]` ä¸­ï¼Œä½¿å¾—ã€Œå‰ k ä¸ªå­—ç¬¦ã€æ°å¥½ç­‰äºã€Œå k ä¸ªå­—ç¬¦ã€çš„ã€Œæœ€é•¿çš„ `k`ã€**ã€‚å½“ç„¶å­ä¸² `p[0: j + 1]` æœ¬èº«ä¸å‚ä¸æ¯”è¾ƒã€‚

ä¸¾ä¸ªä¾‹å­æ¥è¯´æ˜ä¸€ä¸‹ã€‚ä»¥ `ABCABCD` ä¸ºä¾‹ã€‚

- `next[0] = 0`ï¼Œå› ä¸º `"A"` ä¸­æ— æœ‰ç›¸åŒå‰ç¼€åç¼€ï¼Œæœ€å¤§é•¿åº¦ä¸º `0`ã€‚
- `next[1] = 0`ï¼Œå› ä¸º `"AB"` ä¸­æ— ç›¸åŒå‰ç¼€åç¼€ï¼Œæœ€å¤§é•¿åº¦ä¸º `0`ã€‚
- `next[2] = 0`ï¼Œå› ä¸º `"ABC"` ä¸­æ— ç›¸åŒå‰ç¼€åç¼€ï¼Œæœ€å¤§é•¿åº¦ä¸º `0`ã€‚
- `next[3] = 1`ï¼Œå› ä¸º `"ABCA"` ä¸­æœ‰ç›¸åŒçš„å‰ç¼€åç¼€ `"a"`ï¼Œæœ€å¤§é•¿åº¦ä¸º `1`ã€‚
- `next[4] = 2`ï¼Œå› ä¸º `"ABCAB"`  ä¸­æœ‰ç›¸åŒçš„å‰ç¼€åç¼€ `"AB"`ï¼Œæœ€å¤§é•¿åº¦ä¸º `2`ã€‚
- `next[5] = 3`ï¼Œå› ä¸º `"ABCABC"`  ä¸­æœ‰ç›¸åŒçš„å‰ç¼€åç¼€ `"ABC"`ï¼Œæœ€å¤§é•¿åº¦ä¸º `3`ã€‚
- `next[6] = 0`ï¼Œå› ä¸º `"ABCABCD"`  ä¸­æ— ç›¸åŒå‰ç¼€åç¼€ï¼Œæœ€å¤§é•¿åº¦ä¸º `0`ã€‚

åŒç†ä¹Ÿå¯ä»¥è®¡ç®—å‡º `"ABCABDEF"`  çš„å‰ç¼€è¡¨ä¸º `[0, 0, 0, 1, 2, 0, 0, 0]`ï¼Œ`"AABAAAB"`  çš„å‰ç¼€è¡¨ä¸º `[0, 1, 0, 1, 2, 2, 3]`ï¼Œ`"ABCDABD"` çš„å‰ç¼€è¡¨ä¸º `[0, 0, 0, 0, 1, 2, 0]`ã€‚

åœ¨ä¹‹å‰çš„ä¾‹å­ä¸­ï¼Œå½“ `p[5]` å’Œ `T[i + 5]` åŒ¹é…å¤±è´¥åï¼Œæ ¹æ®æ¨¡å¼ä¸²å¤±é…ä½ç½® `j` çš„å‰ä¸€ä¸ªä½ç½®çš„å€¼ï¼Œå³ `next[4] = 2`ï¼Œæˆ‘ä»¬ç›´æ¥è®© `T[i + 5]` ç›´æ¥å¯¹å‡† `p[2]`ï¼Œç„¶åç»§ç»­è¿›è¡Œæ¯”å¯¹ã€‚

![](https://qcdn.itcharge.cn/images/20220205003647.png)

**ä½†æ˜¯è¿™æ ·ç§»åŠ¨çš„åŸç†æ˜¯ä»€ä¹ˆï¼Ÿ**

å…¶å®åœ¨ä¸Šæ–‡ **ã€Œ1.2 KMP ç®—æ³•çš„æ”¹è¿›ã€** ä¸­çš„ä¾‹å­ä¸­æˆ‘ä»¬æåˆ°è¿‡ï¼Œå°†å…¶å»¶ä¼¸æ€»ç»“ä¸€ä¸‹ï¼Œå°±æ˜¯åˆ©ç”¨å‰ç¼€è¡¨è¿›è¡Œæ¨¡å¼ä¸²ç§»åŠ¨çš„åŸç†ã€‚

å¦‚æœæ–‡æœ¬ä¸² `T[i: i + m]` ä¸æ¨¡å¼ä¸² `p` çš„å¤±é…æ˜¯åœ¨ç¬¬ `j` ä¸ªä½ç½®å‘ç”Ÿçš„ï¼Œé‚£ä¹ˆï¼š

- æ–‡æœ¬ä¸² `T` ä»ä¸‹æ ‡ä½ç½® `i` å¼€å§‹è¿ç»­çš„ `j - 1` ä¸ªå­—ç¬¦ï¼Œä¸€å®šä¸æ¨¡å¼ä¸² `p` çš„å‰ `j - 1` ä¸ªå­—ç¬¦ä¸€æ¨¡ä¸€æ ·ï¼Œå³ï¼š`T[i: i + j] == p[0: j]`ã€‚
- è€Œå¦‚æœæ¨¡å¼ä¸² `p` çš„å‰ `j - 1` ä¸ªå­—ç¬¦ä¸­ï¼Œå‰ `k` ä½å‰ç¼€å’Œå `k` ä½åç¼€ç›¸åŒï¼Œå³ `p[0: k] == p[m - k: m]`ï¼Œå¹¶ä¸”è¦ä¿è¯ `k` è¦å°½å¯èƒ½é•¿ã€‚

å¯ä»¥æ¨å‡ºï¼šæ–‡æœ¬ä¸²å­ä¸²çš„å `k` ä½åç¼€å’Œæ¨¡å¼ä¸²å­ä¸²çš„å‰ `k` ä½æ˜¯ç›¸åŒçš„ï¼Œå³ `T[i + m - k: i + m] == p[0: k]`ï¼Œè¿™éƒ¨åˆ†ï¼ˆæ˜¯å·²ç»æ¯”è¾ƒè¿‡çš„ï¼Œä¸éœ€è¦å†æ¯”è¾ƒäº†ï¼Œå¯ä»¥ç›´æ¥è·³è¿‡ã€‚

é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥å°†æ–‡æœ¬ä¸²ä¸­çš„ `T[i + m]` å¯¹å‡†æ¨¡å¼ä¸²ä¸­çš„ `p[k]`ï¼Œç»§ç»­è¿›è¡Œå¯¹æ¯”ã€‚è¿™é‡Œçš„ `k` å…¶å®å°±æ˜¯ `next[j - 1]`ã€‚

## 2. KMP ç®—æ³•æ­¥éª¤

### 3.1 next æ•°ç»„çš„æ„é€ 

æˆ‘ä»¬å¯ä»¥é€šè¿‡é€’æ¨çš„æ–¹å¼æ„é€  `next` æ•°ç»„ã€‚

- æˆ‘ä»¬å¯ä»¥æŠŠæ¨¡å¼ä¸² `p` æ‹†åˆ†æˆ `left`ã€`right`  ä¸¤éƒ¨åˆ†ã€‚`left` è¡¨ç¤ºå‰ç¼€ä¸²å¼€å§‹æ‰€åœ¨çš„ä¸‹æ ‡ä½ç½®ï¼Œ`right` è¡¨ç¤ºåç¼€ä¸²å¼€å§‹æ‰€åœ¨çš„ä¸‹æ ‡ä½ç½®ï¼Œèµ·å§‹æ—¶ `left = 0`ï¼Œ`right = 1`ã€‚
- æ¯”è¾ƒä¸€ä¸‹å‰ç¼€ä¸²å’Œåç¼€ä¸²æ˜¯å¦ç›¸ç­‰ã€‚é€šè¿‡æ¯”è¾ƒ `p[left]` å’Œ `p[right]` æ¥è¿›è¡Œåˆ¤æ–­ã€‚
- å¦‚æœ `p[left] != p[right]`ï¼Œè¯´æ˜å½“å‰çš„å‰åç¼€ä¸ç›¸åŒã€‚åˆ™è®©åç¼€å¼€å§‹ä½ç½® `k` ä¸åŠ¨ï¼Œå‰ç¼€ä¸²å¼€å§‹ä½ç½® `left` ä¸æ–­å›é€€åˆ° `next[left - 1]` ä½ç½®ï¼Œç›´åˆ° `p[left] == p[right]` ä¸ºæ­¢ã€‚
- å¦‚æœ `p[left] == p[right]`ï¼Œè¯´æ˜å½“å‰çš„å‰åç¼€ç›¸åŒï¼Œåˆ™å¯ä»¥å…ˆè®© `left += 1`ï¼Œæ­¤æ—¶ `left`  æ—¢æ˜¯å‰ç¼€ä¸‹ä¸€æ¬¡è¿›è¡Œæ¯”è¾ƒçš„ä¸‹æ ‡ä½ç½®ï¼Œåˆæ˜¯å½“å‰æœ€é•¿å‰åç¼€çš„é•¿åº¦ã€‚
- è®°å½•ä¸‹æ ‡ `right` ä¹‹å‰çš„æ¨¡å¼ä¸² `p` ä¸­ï¼Œæœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦ä¸º `left`ï¼Œå³ `next[right] = left`ã€‚

### 3.2 KMP ç®—æ³•æ•´ä½“æ­¥éª¤

- æ ¹æ® `next` æ•°ç»„çš„æ„é€ æ­¥éª¤ç”Ÿæˆã€Œå‰ç¼€è¡¨ã€`next`ã€‚
- ä½¿ç”¨ä¸¤ä¸ªæŒ‡é’ˆ `i`ã€`j`ï¼Œå…¶ä¸­ `i` æŒ‡å‘æ–‡æœ¬ä¸²ä¸­å½“å‰åŒ¹é…çš„ä½ç½®ï¼Œ`j` æŒ‡å‘æ¨¡å¼ä¸²ä¸­å½“å‰åŒ¹é…çš„ä½ç½®ã€‚åˆå§‹æ—¶ï¼Œ`i = 0`ï¼Œ`j = 0`ã€‚
- å¾ªç¯åˆ¤æ–­æ¨¡å¼ä¸²å‰ç¼€æ˜¯å¦åŒ¹é…æˆåŠŸï¼Œå¦‚æœæ¨¡å¼ä¸²å‰ç¼€åŒ¹é…ä¸æˆåŠŸï¼Œå°†æ¨¡å¼ä¸²è¿›è¡Œå›é€€ï¼Œå³ `j = next[j - 1]`ï¼Œç›´åˆ° `j == 0` æ—¶æˆ–å‰ç¼€åŒ¹é…æˆåŠŸæ—¶åœæ­¢å›é€€ã€‚
- å¦‚æœå½“å‰æ¨¡å¼ä¸²å‰ç¼€åŒ¹é…æˆåŠŸï¼Œåˆ™ä»¤æ¨¡å¼ä¸²å‘å³ç§»åŠ¨ `1` ä½ï¼Œå³ `j += 1`ã€‚
- å¦‚æœå½“å‰æ¨¡å¼ä¸² **å®Œå…¨** åŒ¹é…æˆåŠŸï¼Œåˆ™è¿”å›æ¨¡å¼ä¸² `p` åœ¨æ–‡æœ¬ä¸² `T` ä¸­çš„å¼€å§‹ä½ç½®ï¼Œå³ `i - j + 1`ã€‚
- å¦‚æœè¿˜æœªå®Œå…¨åŒ¹é…æˆåŠŸï¼Œåˆ™ä»¤æ–‡æœ¬ä¸²å‘å³ç§»åŠ¨ `1` ä½ï¼Œå³ `i += 1`ï¼Œç„¶åç»§ç»­åŒ¹é…ã€‚
- å¦‚æœç›´åˆ°æ–‡æœ¬ä¸²éå†å®Œä¹Ÿæœªå®Œå…¨åŒ¹é…æˆåŠŸï¼Œåˆ™è¯´æ˜åŒ¹é…å¤±è´¥ï¼Œè¿”å› `-1`ã€‚

## 3. KMP ç®—æ³•ä»£ç å®ç°

```Python
# KMP åŒ¹é…ç®—æ³•ï¼ŒT ä¸ºæ–‡æœ¬ä¸²ï¼Œp ä¸ºæ¨¡å¼ä¸²
def kmp(T: str, p: str) -> int:
    n, m = len(T), len(p)
    
    next = generateNext(p)                      # ç”Ÿæˆ next æ•°ç»„
    
    j = 0                                       # j ä¸ºæ¨¡å¼ä¸²ä¸­å½“å‰åŒ¹é…çš„ä½ç½®
    for i in range(n):                          # i ä¸ºæ–‡æœ¬ä¸²ä¸­å½“å‰åŒ¹é…çš„ä½ç½®
        while j > 0 and T[i] != p[j]:           # å¦‚æœæ¨¡å¼ä¸²å‰ç¼€åŒ¹é…ä¸æˆåŠŸ, å°†æ¨¡å¼ä¸²è¿›è¡Œå›é€€, j == 0 æ—¶åœæ­¢å›é€€
            j = next[j - 1]
        if T[i] == p[j]:                        # å½“å‰æ¨¡å¼ä¸²å‰ç¼€åŒ¹é…æˆåŠŸï¼Œä»¤ j += 1ï¼Œç»§ç»­åŒ¹é…
            j += 1
        if j == m:                              # å½“å‰æ¨¡å¼ä¸²å®Œå…¨åŒ¹é…æˆåŠŸï¼Œè¿”å›åŒ¹é…å¼€å§‹ä½ç½®
            return i - j + 1
    return -1                                   # åŒ¹é…å¤±è´¥ï¼Œè¿”å› -1
            
    
# ç”Ÿæˆ next æ•°ç»„
# next[j] è¡¨ç¤ºä¸‹æ ‡ j ä¹‹å‰çš„æ¨¡å¼ä¸² p ä¸­ï¼Œæœ€é•¿ç›¸ç­‰å‰åç¼€çš„é•¿åº¦
def generateNext(p: str):
    m = len(p)
    next = [0 for _ in range(m)]                # åˆå§‹åŒ–æ•°ç»„å…ƒç´ å…¨éƒ¨ä¸º 0
    
    left = 0                                    # left è¡¨ç¤ºå‰ç¼€ä¸²å¼€å§‹æ‰€åœ¨çš„ä¸‹æ ‡ä½ç½®
    for right in range(1, m):                   # right è¡¨ç¤ºåç¼€ä¸²å¼€å§‹æ‰€åœ¨çš„ä¸‹æ ‡ä½ç½®
        while left > 0 and p[left] != p[right]: # åŒ¹é…ä¸æˆåŠŸ, left è¿›è¡Œå›é€€, left == 0 æ—¶åœæ­¢å›é€€
            left = next[left - 1]               # left è¿›è¡Œå›é€€æ“ä½œ
        if p[left] == p[right]:                 # åŒ¹é…æˆåŠŸï¼Œæ‰¾åˆ°ç›¸åŒçš„å‰åç¼€ï¼Œå…ˆè®© left += 1ï¼Œæ­¤æ—¶ left ä¸ºå‰ç¼€é•¿åº¦
            left += 1
        next[right] = left                      # è®°å½•å‰ç¼€é•¿åº¦ï¼Œæ›´æ–° next[right], ç»“æŸæœ¬æ¬¡å¾ªç¯, right += 1

    return next

print(kmp("abbcfdddbddcaddebc", "ABCABCD"))
print(kmp("abbcfdddbddcaddebc", "bcf"))
print(kmp("aaaaa", "bba"))
print(kmp("mississippi", "issi"))
print(kmp("ababbbbaaabbbaaa", "bbbb"))
```

## 4. KMP ç®—æ³•åˆ†æ

- KMP ç®—æ³•åœ¨æ„é€ å‰ç¼€è¡¨é˜¶æ®µçš„æ—¶é—´å¤æ‚åº¦ä¸º $O(m)$ï¼Œå…¶ä¸­ $m$ æ˜¯æ¨¡å¼ä¸² `p` çš„é•¿åº¦ã€‚
- KMP ç®—æ³•åœ¨åŒ¹é…é˜¶æ®µï¼Œæ˜¯æ ¹æ®å‰ç¼€è¡¨ä¸æ–­è°ƒæ•´åŒ¹é…çš„ä½ç½®ï¼Œæ–‡æœ¬ä¸²çš„ä¸‹æ ‡ `i` å¹¶æ²¡æœ‰è¿›è¡Œå›é€€ï¼Œå¯ä»¥çœ‹å‡ºåŒ¹é…é˜¶æ®µçš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n)$ï¼Œå…¶ä¸­ $n$ æ˜¯æ–‡æœ¬ä¸² `T` çš„é•¿åº¦ã€‚
- æ‰€ä»¥ KMP æ•´ä¸ªç®—æ³•çš„æ—¶é—´å¤æ‚åº¦æ˜¯ $O(n + m)$ï¼Œç›¸å¯¹äºæœ´ç´ åŒ¹é…ç®—æ³•çš„ $O(n * m)$ çš„æ—¶é—´å¤æ‚åº¦ï¼ŒKMP ç®—æ³•çš„æ•ˆç‡æœ‰äº†å¾ˆå¤§çš„æå‡ã€‚

## å‚è€ƒèµ„æ–™

- ã€ä¹¦ç±ã€‘æŸ”æ€§å­—ç¬¦ä¸²åŒ¹é… - ä¸­ç§‘é™¢è®¡ç®—æ‰€ç½‘ç»œä¿¡æ¯å®‰å…¨ç ”ç©¶ç»„ è¯‘
- ã€ä¹¦ç±ã€‘ACM-ICPC ç¨‹åºè®¾è®¡ç³»åˆ— - ç®—æ³•è®¾è®¡ä¸å®ç° - é™ˆå®‡ å´æ˜Š ä¸»ç¼–
- ã€åšæ–‡ã€‘[ä»å¤´åˆ°å°¾å½»åº•ç†è§£ KMP - ç»“æ„ä¹‹æ³• ç®—æ³•ä¹‹é“ - CSDNåšå®¢](https://blog.csdn.net/v_JULY_v/article/details/7041827?spm=1001.2014.3001.5502)
- ã€åšæ–‡ã€‘[å­—ç¬¦ä¸²åŒ¹é…çš„ KMP ç®—æ³• - é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—](http://www.ruanyifeng.com/blog/2013/05/Knuthâ€“Morrisâ€“Pratt_algorithm.html)
- ã€é¢˜è§£ã€‘[å¤šå›¾é¢„è­¦ğŸ‘ŠğŸ»è¯¦è§£ KMP ç®—æ³• - å®ç° strStr() - åŠ›æ‰£](https://leetcode-cn.com/problems/implement-strstr/solution/duo-tu-yu-jing-xiang-jie-kmp-suan-fa-by-w3c9c/)
- ã€é¢˜è§£ã€‘[ã€Œä»£ç éšæƒ³å½•ã€KMPç®—æ³•è¯¦è§£ - å®ç° strStr() - åŠ›æ‰£](https://leetcode-cn.com/problems/implement-strstr/solution/dai-ma-sui-xiang-lu-kmpsuan-fa-xiang-jie-mfbs/)